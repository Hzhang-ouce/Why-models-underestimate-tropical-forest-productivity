plot02<- ggarrange(ac_figure, aj_figure, ncol = 3, nrow = 1)+ggtitle('Calculate GPP with measured traits and measured climate')
annotate_figure(plot02, top = text_grob("Experiment Pmodel_PfT\n (Checking coordination hypothesis Ac=Aj)",
color = "black", face = "bold", size = 10))
ac_figure<-ggplot() +
geom_bar( aes(x=SITE, y=a_c ), stat="identity",data=Field_measurement_based_GPP, fill=Field_measurement_based_GPP$colour, alpha=0.7,width = 0.8) +
ylab(bquote('C[max] (mol C'~ m^-2~day^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(0,1.2)) +  theme(title = element_text(size=9),
plot.title = element_markdown())
aj_figure<-ggplot() +
geom_bar( aes(x=SITE, y=a_j ), stat="identity",data=Field_measurement_based_GPP, fill=Field_measurement_based_GPP$colour, alpha=0.7,width = 0.8) +
ylab(bquote('A[J] (mol C'~ m^-2~day^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(0,1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
plot02<- ggarrange(ac_figure, aj_figure, ncol = 3, nrow = 1)+ggtitle('Calculate GPP with measured traits and measured climate')
annotate_figure(plot02, top = text_grob("Experiment Pmodel_PfT\n (Checking coordination hypothesis Ac=Aj)",
color = "black", face = "bold", size = 10))
ac_figure<-ggplot() +
geom_bar( aes(x=SITE, y=a_c ), stat="identity",data=Field_measurement_based_GPP, fill=Field_measurement_based_GPP$colour, alpha=0.7,width = 0.8) +
ylab(bquote(Vc[max](mu~mol ~CO[2]~ m^-2~s^-1)))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(0,1.2)) +  theme(title = element_text(size=9),
plot.title = element_markdown())
aj_figure<-ggplot() +
geom_bar( aes(x=SITE, y=a_j ), stat="identity",data=Field_measurement_based_GPP, fill=Field_measurement_based_GPP$colour, alpha=0.7,width = 0.8) +
ylab(bquote('A[J] (mol C'~ m^-2~day^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(0,1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
plot02<- ggarrange(ac_figure, aj_figure, ncol = 3, nrow = 1)+ggtitle('Calculate GPP with measured traits and measured climate')
annotate_figure(plot02, top = text_grob("Experiment Pmodel_PfT\n (Checking coordination hypothesis Ac=Aj)",
color = "black", face = "bold", size = 10))
ac_figure<-ggplot() +
geom_bar( aes(x=SITE, y=a_c ), stat="identity",data=Field_measurement_based_GPP, fill=Field_measurement_based_GPP$colour, alpha=0.7,width = 0.8) +
ylab(bquote(A[C](mu~mol ~CO[2]~ m^-2~s^-1)))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(0,1.2)) +  theme(title = element_text(size=9),
plot.title = element_markdown())
aj_figure<-ggplot() +
geom_bar( aes(x=SITE, y=a_j ), stat="identity",data=Field_measurement_based_GPP, fill=Field_measurement_based_GPP$colour, alpha=0.7,width = 0.8) +
ylab(bquote('A[J] (mol C'~ m^-2~day^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(0,1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
plot02<- ggarrange(ac_figure, aj_figure, ncol = 3, nrow = 1)+ggtitle('Calculate GPP with measured traits and measured climate')
annotate_figure(plot02, top = text_grob("Experiment Pmodel_PfT\n (Checking coordination hypothesis Ac=Aj)",
color = "black", face = "bold", size = 10))
ac_figure<-ggplot() +
geom_bar( aes(x=SITE, y=a_c ), stat="identity",data=Field_measurement_based_GPP, fill=Field_measurement_based_GPP$colour, alpha=0.7,width = 0.8) +
ylab(bquote(A[C](mol~C ~ m^-2~day^-1)))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(0,1.2)) +  theme(title = element_text(size=9),
plot.title = element_markdown())
aj_figure<-ggplot() +
geom_bar( aes(x=SITE, y=a_j ), stat="identity",data=Field_measurement_based_GPP, fill=Field_measurement_based_GPP$colour, alpha=0.7,width = 0.8) +
ylab(bquote('A[J] (mol C'~ m^-2~day^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(0,1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
plot02<- ggarrange(ac_figure, aj_figure, ncol = 3, nrow = 1)+ggtitle('Calculate GPP with measured traits and measured climate')
annotate_figure(plot02, top = text_grob("Experiment Pmodel_PfT\n (Checking coordination hypothesis Ac=Aj)",
color = "black", face = "bold", size = 10))
ac_figure<-ggplot() +
geom_bar( aes(x=SITE, y=a_c ), stat="identity",data=Field_measurement_based_GPP, fill=Field_measurement_based_GPP$colour, alpha=0.7,width = 0.8) +
ylab(bquote(A[C](mol~C ~ m^-2~day^-1)))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(0,1.2)) +  theme(title = element_text(size=9),
plot.title = element_markdown())
aj_figure<-ggplot() +
geom_bar( aes(x=SITE, y=a_j ), stat="identity",data=Field_measurement_based_GPP, fill=Field_measurement_based_GPP$colour, alpha=0.7,width = 0.8) +
ylab(bquote(A[J](mol~C ~ m^-2~day^-1)))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(0,1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
plot02<- ggarrange(ac_figure, aj_figure, ncol = 3, nrow = 1)+ggtitle('Calculate GPP with measured traits and measured climate')
annotate_figure(plot02, top = text_grob("Experiment Pmodel_PfT\n (Checking coordination hypothesis Ac=Aj)",
color = "black", face = "bold", size = 10))
ggsave(filename = "H:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/Experiment_Pmodel_trait_ac_aj.jpg",width = 4.57, height = 2.7, dpi = 300)
ggsave(filename = "F:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/Experiment_Pmodel_trait_ac_aj.jpg",width = 4.57, height = 2.7, dpi = 300)
setwd("F:/Oxford/Chapter_three/github_version/Rpmodel_V3")
files.sources = list.files(pattern ='*.R')
sapply(files.sources, source)
setwd("F:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/")
for (i in 1:3){
temp_result<-Field_measurement_table[i,]
rp_model_output<-rpmodel(
tc=temp_result$tc,
vpd=temp_result$VPDmean,
co2=414,
fapar=temp_result$FAPAR,
ppfd=temp_result$ppfd_field ,
patm = NA,
elv=temp_result$elv,
beta = 146,
soilm = 1,
meanalpha = 1,
apar_soilm = 0,
bpar_soilm = 0.733,
c4 = FALSE,
method_jmaxlim = "wang17", #Other options are "smith19" or 'none' "wang17",
do_ftemp_kphio = TRUE,
do_soilmstress = FALSE,
returnvar = NULL,
verbose = FALSE
)
if (i==1) {
rp_model_output2<-as.data.frame(rp_model_output)
} else {
rp_model_output2[i,]<-as.data.frame(rp_model_output)
}
rp_model_output2$SITE[i]<-as.character(result[i,'SITE'])
}
setwd("F:/Oxford/Chapter_three/github_version/Rpmodel_V3")
files.sources = list.files(pattern ='*.R')
sapply(files.sources, source)
setwd("F:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/")
for (i in 1:3){
temp_result<-Field_measurement_table[i,]
rp_model_output<-rpmodel(
tc=temp_result$tc,
vpd=temp_result$VPDmean,
co2=414,
fapar=temp_result$FAPAR,
ppfd=temp_result$ppfd_field ,
patm = NA,
elv=temp_result$elv,
beta = 146,
soilm = 1,
meanalpha = 1,
apar_soilm = 0,
bpar_soilm = 0.733,
c4 = FALSE,
method_jmaxlim = "wang17", #Other options are "smith19" or 'none' "wang17",
do_ftemp_kphio = TRUE,
do_soilmstress = FALSE,
returnvar = NULL,
verbose = FALSE
)
if (i==1) {
rp_model_output2<-as.data.frame(rp_model_output)
} else {
rp_model_output2[i,]<-as.data.frame(rp_model_output)
}
rp_model_output2$SITE[i]<-as.character(result[i,'SITE'])
}
library(multcompView)
library(tidyverse)
library(Hmisc)
library(multcomp)
library(vegan)
library(ARTofR)
library(tidyverse)
library(ggplot2)
library(ggtext)
library(ggsci)
library(ggpubr)
rm(list=ls())
setwd("F:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/")
source('F:/Oxford/Chapter_three/github_version/Rpmodel_V3/subroutines.R')
Field_measurement_table<-openxlsx::read.xlsx('F:/Oxford/Chapter_three/github_version/3.supplementary_compare_climate_variable/Field_measurement_photosynthesis_trait.xlsx' )
Ratio_Jmax_to_vcmax <- Field_measurement_table$Jmax_onepoint_25C / Field_measurement_table$Vcmax_onepoint_25C
library(tidyverse)
J_to_mol = 4.6 # this will convert J m-2 s-1 (= W m-2) to umol (quanta) m-2 s-1
to_PPFD=1*1000000000/365/24/3600 * J_to_mol / 1000000 *3600*24*0.45 # this one will convert  (GJ m-2 year-1) to mol/m2/d, the 0.45 is photosynthetically active fraction (which is called PAR, see Wang et al Nature plants)
c_molmass <- 12.0107  # molecular mass of carbon (g)
kPo <- 101325.0       # standard atmosphere, Pa (Allen, 1973)
kTo <- 25.0           # base temperature, deg C (Prentice, unpublished)
rd_to_vcmax <- 0.015  # Ratio of Rdark to Vcmax25, number from Atkin et al., 2015 for C3 herbaceous
soilmstress <- 1.0
beta = 146.0
load("F:/Oxford/Chapter_three/github_version/2_Figure_four_timeseries_of_fapar/organized_climate_withppfd_two_fapar.rda")
result$VPDmean=result$VPDmean*1000
result$FAPAR=result$fapar_no_cloud/100
result$ppfd=result$ppfd/30 # to mol/m2/d,
colnames(result)[1]<-'SITE'
List_of_site<-c('KOG','BOB','ANK')
cls <- data.frame(SITE=List_of_site, colour=c("#deebf7","#9ecae1","#3182bd"))
result <- result%>%
left_join(cls, by="SITE")
result$SITE <- factor(result$SITE, levels = c("ANK", "BOB", "KOG"))
result<-arrange(result,SITE)
Field_measurement_table<-left_join(Field_measurement_table,result, by='SITE')%>%
dplyr::rename(chi  = cica,
tc = Tmean)
result$SITE <- str_replace(result$SITE, "ANK", "ANK (wet)")
result$SITE <- str_replace(result$SITE, "BOB", "BOB (mid)")
result$SITE <- str_replace(result$SITE, "KOG", "KOG (dry)")
Field_measurement_table$SITE <- factor(Field_measurement_table$SITE, levels = c("ANK", "BOB", "KOG"))
Field_measurement_table$SITE <- str_replace(Field_measurement_table$SITE, "ANK", "ANK (wet)")
Field_measurement_table$SITE <- str_replace(Field_measurement_table$SITE, "BOB", "BOB (mid)")
Field_measurement_table$SITE <- str_replace(Field_measurement_table$SITE, "KOG", "KOG (dry)")
Field_measurement_table<-Field_measurement_table%>%
mutate(jmax=Jmax_onepoint_25C*jmax25_to_jmax ,
vcmax=Vcmax_onepoint_25C*vcmax25_to_vcmax,
jmax_se=Jmax_onepoint_se*jmax25_to_jmax,
vcmax_se = Vcmax_onepoint_se*vcmax25_to_vcmax)
setwd("F:/Oxford/Chapter_three/github_version/Rpmodel_V3")
files.sources = list.files(pattern ='*.R')
sapply(files.sources, source)
setwd("F:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/")
for (i in 1:3){
temp_result<-Field_measurement_table[i,]
rp_model_output<-rpmodel(
tc=temp_result$tc,
vpd=temp_result$VPDmean,
co2=414,
fapar=temp_result$FAPAR,
ppfd=temp_result$ppfd_field ,
patm = NA,
elv=temp_result$elv,
beta = 146,
soilm = 1,
meanalpha = 1,
apar_soilm = 0,
bpar_soilm = 0.733,
c4 = FALSE,
method_jmaxlim = "wang17", #Other options are "smith19" or 'none' "wang17",
do_ftemp_kphio = TRUE,
do_soilmstress = FALSE,
returnvar = NULL,
verbose = FALSE
)
if (i==1) {
rp_model_output2<-as.data.frame(rp_model_output)
} else {
rp_model_output2[i,]<-as.data.frame(rp_model_output)
}
rp_model_output2$SITE[i]<-as.character(result[i,'SITE'])
}
result_no_soilm<-dplyr::left_join(result,rp_model_output2,by="SITE")
result_no_soilm$vcmax<-result_no_soilm$vcmax * 10^6 /24/3600 #from mol C m-2 day-1 to umol m-2 s-1
result_no_soilm$vcmax25<-result_no_soilm$vcmax25 * 10^6 /24/3600 #from mol C m-2 day-1 to umol m-2 s-1
result_no_soilm$jmax<-result_no_soilm$jmax * 10^6 /24/3600 #from mol C m-2 day-1 to umol m-2 s-1
result_no_soilm$jmax25<-result_no_soilm$jmax25* 10^6 /24/3600 #from mol C m-2 day-1 to umol m-2 s-1
result_no_soilm$gpp<-result_no_soilm$gpp / 10^6 * 10000 * 365 #from g C m-2 day-1 to MgC per ha yr-1
result_no_soilm<-result_no_soilm%>%
mutate(vcmax=vcmax/FAPAR,
vcmax25 = vcmax25/FAPAR,
jmax = jmax/FAPAR,
jmax25 = jmax25/FAPAR,
iabs_no_fpar=iabs/FAPAR)%>%
dplyr::rename(iabs_with_fpar=iabs)
result_no_soilm$SITE<-c('ANK','BOB','KOG')
Field_measurement_table$SITE<-c('ANK','BOB','KOG')
GPP_figure<-ggplot() +
geom_bar( aes(x=SITE, y=gpp), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=gpp, ymin=gpp-gpp_se, ymax=gpp+gpp_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=gpp),color='red', size=2,data = result_no_soilm)+
ylab(bquote('GPP (MgC'~ ha^-1~year^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilm$gpp,na.rm=T)*0,max(Field_measurement_table$gpp,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
jmax_figure<-ggplot(result_no_soilm) +
geom_bar( aes(x=SITE, y=jmax), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=jmax, ymin=jmax-jmax_se, ymax=jmax+jmax_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=jmax),color='red', size=2,data = result_no_soilm)+   ylab(bquote('Jmax_Tair ('*umol ~CO[2]~ m^-2~s^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(Field_measurement_table$jmax,na.rm=T)*0,max(Field_measurement_table$jmax,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
vcmax_figure<-ggplot(result_no_soilm) +
geom_bar( aes(x=SITE, y=vcmax), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=vcmax, ymin=vcmax-vcmax_se, ymax=vcmax+vcmax_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=vcmax),color='red', size=2,data = result_no_soilm)+   ylab(bquote('Vcmax_Tair ('*umol ~CO[2]~ m^-2~s^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(Field_measurement_table$vcmax,na.rm=T)*0,max(Field_measurement_table$vcmax,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
Field_measurement_based_GPP<-openxlsx::read.xlsx( '2023-04-14_plug_in_vcmax_jmax_and_get_Pmodel_output.xlsx')
Field_measurement_based_GPP$SITE<-c('ANK','BOB','KOG')
result_no_soilmacaj<-result_no_soilm%>%
mutate(Aj=gpp/FAPAR/c_molmass* 10^6 / 10000 / 365)%>%
left_join(Field_measurement_based_GPP%>%dplyr::select(SITE,a_j,FAPAR_field))
GPP_figure<-ggplot() +
geom_bar( aes(x=SITE, y=gpp), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=gpp, ymin=gpp-gpp_se, ymax=gpp+gpp_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=gpp),color='red', size=2,data = result_no_soilm)+
ylab(bquote('GPP (MgC'~ ha^-1~year^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilm$gpp,na.rm=T)*0,max(Field_measurement_table$gpp,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
jmax_figure<-ggplot(result_no_soilm) +
geom_bar( aes(x=SITE, y=jmax), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=jmax, ymin=jmax-jmax_se, ymax=jmax+jmax_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=jmax),color='red', size=2,data = result_no_soilm)+   ylab(bquote('Jmax_Tair ('*umol ~CO[2]~ m^-2~s^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(Field_measurement_table$jmax,na.rm=T)*0,max(Field_measurement_table$jmax,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
vcmax_figure<-ggplot(result_no_soilm) +
geom_bar( aes(x=SITE, y=vcmax), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=vcmax, ymin=vcmax-vcmax_se, ymax=vcmax+vcmax_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=vcmax),color='red', size=2,data = result_no_soilm)+   ylab(bquote('Vcmax_Tair ('*umol ~CO[2]~ m^-2~s^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(Field_measurement_table$vcmax,na.rm=T)*0,max(Field_measurement_table$vcmax,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
Field_measurement_based_GPP<-openxlsx::read.xlsx( '2023-04-14_plug_in_vcmax_jmax_and_get_Pmodel_output.xlsx')
Field_measurement_based_GPP$SITE<-c('ANK','BOB','KOG')
result_no_soilmacaj<-result_no_soilm%>%
mutate(Aj=gpp/FAPAR/c_molmass* 10^6 / 10000 / 365)%>%
left_join(Field_measurement_based_GPP%>%dplyr::select(SITE,a_j,FAPAR_field))
Aj_figure<-ggplot(result_no_soilmacaj) +
geom_bar( aes(x=SITE, y=a_j), stat="identity",data=result_no_soilmacaj, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_point(aes(x=SITE, y=Aj),color='red', size=2,data = result_no_soilmacaj)+  ylab(bquote(A[J](mol~C ~ m^-2~day^-1)))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilmacaj$a_j,na.rm=T)*0,max(result_no_soilmacaj$a_j,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
fapar_figure<-ggplot(result_no_soilmacaj) +
geom_bar( aes(x=SITE, y=FAPAR_field*100), stat="identity",data=result_no_soilmacaj, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_point(aes(x=SITE, y=FAPAR*100),color='red', size=2,data = result_no_soilmacaj)+  ylab("fAPAR (%)")+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilmacaj$FAPAR_field,na.rm=T)*0,max(result_no_soilmacaj$FAPAR_field,na.rm=T)*120)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
plot1<- ggarrange(GPP_figure, jmax_figure, vcmax_figure,Aj_figure,fapar_figure, ncol = 5, nrow =1 )
annotate_figure(plot1, top = text_grob("Experiment_Pmodel_P\n(Using field based PPFD, but satellite based fAPAR and modelled LUE)",
color = "black", face = "bold", size = 10))
#openxlsx::write.xlsx(result_no_soilm,file='H:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/Experiment_Pmodel_PPFD.xlsx')
result_no_soilm<-openxlsx::read.xlsx('Experiment_Pmodel_PPFD.xlsx')
GPP_figure<-ggplot() +
geom_bar( aes(x=SITE, y=gpp), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=gpp, ymin=gpp-gpp_se, ymax=gpp+gpp_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=gpp),color='red', size=2,data = result_no_soilm)+
ylab(bquote('GPP (MgC'~ ha^-1~year^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilm$gpp,na.rm=T)*0,max(Field_measurement_table$gpp,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
jmax_figure<-ggplot(result_no_soilm) +
geom_bar( aes(x=SITE, y=jmax), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=jmax, ymin=jmax-jmax_se, ymax=jmax+jmax_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=jmax),color='red', size=2,data = result_no_soilm)+   ylab(bquote('Jmax_Tair ('*umol ~CO[2]~ m^-2~s^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(Field_measurement_table$jmax,na.rm=T)*0,max(Field_measurement_table$jmax,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
vcmax_figure<-ggplot(result_no_soilm) +
geom_bar( aes(x=SITE, y=vcmax), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=vcmax, ymin=vcmax-vcmax_se, ymax=vcmax+vcmax_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=vcmax),color='red', size=2,data = result_no_soilm)+   ylab(bquote('Vcmax_Tair ('*umol ~CO[2]~ m^-2~s^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(Field_measurement_table$vcmax,na.rm=T)*0,max(Field_measurement_table$vcmax,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
Field_measurement_based_GPP<-openxlsx::read.xlsx( '2023-04-14_plug_in_vcmax_jmax_and_get_Pmodel_output.xlsx')
Field_measurement_based_GPP$SITE<-c('ANK','BOB','KOG')
result_no_soilmacaj<-result_no_soilm%>%
mutate(Aj=gpp/FAPAR/c_molmass* 10^6 / 10000 / 365)%>%
left_join(Field_measurement_based_GPP%>%dplyr::select(SITE,a_j,FAPAR_field))
Aj_figure<-ggplot(result_no_soilmacaj) +
geom_bar( aes(x=SITE, y=a_j), stat="identity",data=result_no_soilmacaj, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_point(aes(x=SITE, y=Aj),color='red', size=2,data = result_no_soilmacaj)+  ylab(bquote(A[J](mol~C ~ m^-2~day^-1)))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilmacaj$a_j,na.rm=T)*0,max(result_no_soilmacaj$a_j,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
fapar_figure<-ggplot(result_no_soilmacaj) +
geom_bar( aes(x=SITE, y=FAPAR_field*100), stat="identity",data=result_no_soilmacaj, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_point(aes(x=SITE, y=FAPAR*100),color='red', size=2,data = result_no_soilmacaj)+  ylab("fAPAR (%)")+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilmacaj$FAPAR_field,na.rm=T)*0,max(result_no_soilmacaj$FAPAR_field,na.rm=T)*120)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
#openxlsx::write.xlsx(result_no_soilm,file='H:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/Experiment_Pmodel_PPFD.xlsx')
result_no_soilm<-openxlsx::read.xlsx('Experiment_Pmodel_PPFD.xlsx')
result_no_soilm$SITE<-c('ANK','BOB','KOG')
Field_measurement_table$SITE<-c('ANK','BOB','KOG')
GPP_figure<-ggplot() +
geom_bar( aes(x=SITE, y=gpp), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=gpp, ymin=gpp-gpp_se, ymax=gpp+gpp_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=gpp),color='red', size=2,data = result_no_soilm)+
ylab(bquote('GPP (MgC'~ ha^-1~year^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilm$gpp,na.rm=T)*0,max(Field_measurement_table$gpp,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
jmax_figure<-ggplot(result_no_soilm) +
geom_bar( aes(x=SITE, y=jmax), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=jmax, ymin=jmax-jmax_se, ymax=jmax+jmax_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=jmax),color='red', size=2,data = result_no_soilm)+   ylab(bquote('Jmax_Tair ('*umol ~CO[2]~ m^-2~s^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(Field_measurement_table$jmax,na.rm=T)*0,max(Field_measurement_table$jmax,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
vcmax_figure<-ggplot(result_no_soilm) +
geom_bar( aes(x=SITE, y=vcmax), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=vcmax, ymin=vcmax-vcmax_se, ymax=vcmax+vcmax_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=vcmax),color='red', size=2,data = result_no_soilm)+   ylab(bquote('Vcmax_Tair ('*umol ~CO[2]~ m^-2~s^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(Field_measurement_table$vcmax,na.rm=T)*0,max(Field_measurement_table$vcmax,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
Field_measurement_based_GPP<-openxlsx::read.xlsx( '2023-04-14_plug_in_vcmax_jmax_and_get_Pmodel_output.xlsx')
Field_measurement_based_GPP$SITE<-c('ANK','BOB','KOG')
result_no_soilmacaj<-result_no_soilm%>%
mutate(Aj=gpp/FAPAR/c_molmass* 10^6 / 10000 / 365)%>%
left_join(Field_measurement_based_GPP%>%dplyr::select(SITE,a_j,FAPAR_field))
Aj_figure<-ggplot(result_no_soilmacaj) +
geom_bar( aes(x=SITE, y=a_j), stat="identity",data=result_no_soilmacaj, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_point(aes(x=SITE, y=Aj),color='red', size=2,data = result_no_soilmacaj)+  ylab(bquote(A[J](mol~C ~ m^-2~day^-1)))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilmacaj$a_j,na.rm=T)*0,max(result_no_soilmacaj$a_j,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
fapar_figure<-ggplot(result_no_soilmacaj) +
geom_bar( aes(x=SITE, y=FAPAR_field*100), stat="identity",data=result_no_soilmacaj, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_point(aes(x=SITE, y=FAPAR*100),color='red', size=2,data = result_no_soilmacaj)+  ylab("fAPAR (%)")+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilmacaj$FAPAR_field,na.rm=T)*0,max(result_no_soilmacaj$FAPAR_field,na.rm=T)*120)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
plot1<- ggarrange(GPP_figure, jmax_figure, vcmax_figure,Aj_figure,fapar_figure, ncol = 5, nrow =1 )
annotate_figure(plot1, top = text_grob("Experiment_Pmodel_P\n(Using field based PPFD, but satellite based fAPAR and modelled LUE)",
color = "black", face = "bold", size = 10))
ggsave(filename = "H:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/Experiment_Pmodel_PPFD 2024.jpg",width = 6.8, height = 2.7, dpi = 300)
ggsave(filename = "F:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/Experiment_Pmodel_PPFD 2024.jpg",width = 6.8, height = 2.7, dpi = 300)
result_no_soilm<-openxlsx::read.xlsx('Experiment P_model_fAPAR.xlsx')
result_no_soilm$SITE<-c('ANK','BOB','KOG')
Field_measurement_table$SITE<-c('ANK','BOB','KOG')
GPP_figure<-ggplot() +
geom_bar( aes(x=SITE, y=gpp), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=gpp, ymin=gpp-gpp_se, ymax=gpp+gpp_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=gpp),color='red', size=2,data = result_no_soilm)+
ylab(bquote('GPP (MgC'~ ha^-1~year^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilm$gpp,na.rm=T)*0,max(Field_measurement_table$gpp,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
jmax_figure<-ggplot(result_no_soilm) +
geom_bar( aes(x=SITE, y=jmax), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=jmax, ymin=jmax-jmax_se, ymax=jmax+jmax_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=jmax),color='red', size=2,data = result_no_soilm)+   ylab(bquote('Jmax_Tair ('*umol ~CO[2]~ m^-2~s^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(Field_measurement_table$jmax,na.rm=T)*0,max(Field_measurement_table$jmax,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
vcmax_figure<-ggplot(result_no_soilm) +
geom_bar( aes(x=SITE, y=vcmax), stat="identity",data=Field_measurement_table, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_errorbar(aes(x=SITE, y=vcmax, ymin=vcmax-vcmax_se, ymax=vcmax+vcmax_se),alpha=0.3, size=1.3,width=0.4,data=Field_measurement_table)+
geom_point(aes(x=SITE, y=vcmax),color='red', size=2,data = result_no_soilm)+   ylab(bquote('Vcmax_Tair ('*umol ~CO[2]~ m^-2~s^-1*')'))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(Field_measurement_table$vcmax,na.rm=T)*0,max(Field_measurement_table$vcmax,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
Field_measurement_based_GPP<-openxlsx::read.xlsx( '2023-03-15_plug_in_vcmax_jmax_and_get_Pmodel_output.xlsx')
Field_measurement_based_GPP$SITE<-c('ANK','BOB','KOG')
result_no_soilmacaj<-result_no_soilm%>%
mutate(Aj=gpp/FAPAR_field/c_molmass* 10^6 / 10000 / 365)%>%
left_join(Field_measurement_based_GPP%>%dplyr::select(SITE,a_j,FAPAR_field))
Aj_figure<-ggplot(result_no_soilmacaj) +
geom_bar( aes(x=SITE, y=a_j), stat="identity",data=result_no_soilmacaj, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_point(aes(x=SITE, y=Aj),color='red', size=2,data = result_no_soilmacaj)+  ylab(bquote(A[J](mol~C ~ m^-2~day^-1)))+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilmacaj$a_j,na.rm=T)*0,max(result_no_soilmacaj$a_j,na.rm=T)*1.2)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
fapar_figure<-ggplot(result_no_soilmacaj) +
geom_bar( aes(x=SITE, y=FAPAR_field*100), stat="identity",data=result_no_soilmacaj, fill=result_no_soilm$colour, alpha=0.7,width = 0.8) +
geom_point(aes(x=SITE, y=FAPAR_field*100),color='red', size=2,data = result_no_soilmacaj)+  ylab("fAPAR (%)")+
xlab("Study sites")+ theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
coord_cartesian( ylim = c(min(result_no_soilmacaj$FAPAR_field,na.rm=T)*0,max(result_no_soilmacaj$FAPAR_field,na.rm=T)*120)) +
theme(title = element_text(size=9),
plot.title = element_markdown())
plot2<- ggarrange(GPP_figure, jmax_figure, vcmax_figure,Aj_figure,fapar_figure, ncol = 5, nrow = 1)+ggtitle('')
annotate_figure(plot2, top = text_grob("Experiment Pmodel_Pf\n (Using field based PPFD and fAPAR, but modelled LUE)",
color = "black", face = "bold", size = 10))
openxlsx::write.xlsx(result_no_soilm,file='F:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/Experiment P_model_fAPAR_2024.xlsx')
ggsave(filename = "H:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/Experiment P_model_fAPAR_2024.jpg",width = 6.8, height = 2.7, dpi = 300)
ggsave(filename = "F:/Oxford/Chapter_three/github_version/4.Figure_two_GPP_from_measured_Vcmax/Experiment P_model_fAPAR_2024.jpg",width = 6.8, height = 2.7, dpi = 300)
